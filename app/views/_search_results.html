<hr>

<div class="panel panel-default search-results">
  <div class="panel-heading">
    <h3 class="panel-title">Search Results</h3>
  </div>
  <div class="panel-body">

    <% if (photos.length) { %>

      <ul>
        <% photos.forEach(function (photo) { %>
          <li class="list-unstyled">
            <a href="<%= photo.media.b %>" class="thumbnail">
              <img src="<%= photo.media.t %>" alt="Photo - <%= photo.title %>"
                title="<%= photo.title %>">
            </a>
          </li>
        <% }) %>
      </ul>
    <div style="display: flex">
      <form action="/zip?tags=<%= tagsParameter %>" method="POST">
        <button type="submit" class="btn btn-primary">Zip Results</button>
      </form>

      <button id="google-sign-in" class="btn btn-primary" style="margin-left: 1rem">Se connecter</button>
      <button id="sign-out" class="btn btn-secondary" style="display: none; margin-left: 1rem">Se déconnecter</button>
    </div>

    <% } else { %>
      <div class="alert alert-info"><strong>No results</strong></div>
    <% } %>

  </div>

</div>

<script type="module">
  // Importation des modules nécessaires de Firebase
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js';
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js';

  // Configuration Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBMRbEW18ViCFCVdLS6lyoMfx0Z9ZGgW9U",
    authDomain: "dmii-2024.firebaseapp.com",
    projectId: "dmii-2024",
    storageBucket: "dmii-2024.appspot.com",
    messagingSenderId: "871398193932",
    appId: "1:871398193932:web:4b9e45e35be93526b96729"
  };

  // Initialisation de Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Sélection des boutons de connexion et déconnexion
  const signInButton = document.getElementById('google-sign-in');
  const signOutButton = document.getElementById('sign-out');

  // Gérer le clic sur le bouton de connexion
  signInButton.addEventListener('click', () => {
    const provider = new GoogleAuthProvider();
    signInWithPopup(auth, provider)
      .then((result) => {
        // L'utilisateur est connecté avec succès
        console.log('Utilisateur connecté:', result.user);
        signInButton.style.display = 'none';
        signOutButton.style.display = 'block';
      })
      .catch((error) => {
        console.error('Erreur lors de la connexion:', error);
      });
  });

  // Gérer le clic sur le bouton de déconnexion
  signOutButton.addEventListener('click', () => {
    signOut(auth)
      .then(() => {
        // L'utilisateur est déconnecté
        console.log('Utilisateur déconnecté');
        signInButton.style.display = 'block';
        signOutButton.style.display = 'none';
      })
      .catch((error) => {
        console.error('Erreur lors de la déconnexion:', error);
      });
  });

  // Surveiller l'état d'authentification
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // L'utilisateur est connecté
      console.log('Utilisateur connecté:', user);
      signInButton.style.display = 'none';
      signOutButton.style.display = 'block';
    } else {
      // Aucun utilisateur connecté
      console.log('Aucun utilisateur connecté');
      signInButton.style.display = 'block';
      signOutButton.style.display = 'none';
    }
  });
</script>
